"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[721],{11952:function(e,t,r){var o=r(52040),i=r(91083).Buffer;Object.defineProperty(t,"__esModule",{value:!0});var n={Client:!0,CopyConditions:!0,PostPolicy:!0},a=A(r(44749),!0),s=A(r(34152),!0),l=A(r(85981),!0),u=r(53625),c=r(57107),p=r(84835),d=A(r(74641),!0),f=r(42406),m=r(31616),h=r(92843),y=A(r(83613),!0),b=r(4078),g=r(6481);Object.keys(g).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e))&&(e in t&&t[e]===g[e]||(t[e]=g[e]))});var E=r(2346),w=r(62242);t.CopyConditions=w.CopyConditions;var v=r(32815),k=r(560);t.PostPolicy=k.PostPolicy;var I=r(85673),T=r(69171);Object.keys(T).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e))&&(e in t&&t[e]===T[e]||(t[e]=T[e]))});var O=r(29605),j=r(99150),N=r(93914),B=A(r(6174),!0),S=r(72573);function R(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(R=function(e){return e?r:t})(e)}function A(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=R(t);if(r&&r.has(e))return r.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=i?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=e[n]}return o.default=e,r&&r.set(e,o),o}class V extends E.TypedClient{setAppInfo(e,t){if(!(0,v.isString)(e))throw TypeError(`Invalid appName: ${e}`);if(""===e.trim())throw new y.InvalidArgumentError("Input appName cannot be empty.");if(!(0,v.isString)(t))throw TypeError(`Invalid appVersion: ${t}`);if(""===t.trim())throw new y.InvalidArgumentError("Input appVersion cannot be empty.");this.userAgent=`${this.userAgent} ${e}/${t}`}calculatePartSize(e){if(!(0,v.isNumber)(e))throw TypeError('size should be of type "number"');if(e>this.maxObjectSize)throw TypeError(`size should not be more than ${this.maxObjectSize}`);if(this.overRidePartSize)return this.partSize;for(var t=this.partSize;;){if(1e4*t>e)return t;t+=16777216}}logHTTP(e,t,r){if(this.logStream){if(!(0,v.isObject)(e))throw TypeError('reqOptions should be of type "object"');if(t&&!(0,v.isReadableStream)(t))throw TypeError('response should be of type "Stream"');if(r&&!(r instanceof Error))throw TypeError('err should be of type "Error"');var o=e=>{p.forEach(e,(e,t)=>{if("authorization"==t){var r=RegExp("Signature=([0-9a-f]+)");e=e.replace(r,"Signature=**REDACTED**")}this.logStream.write(`${t}: ${e}
`)}),this.logStream.write("\n")};if(this.logStream.write(`REQUEST: ${e.method} ${e.path}
`),o(e.headers),t&&(this.logStream.write(`RESPONSE: ${t.statusCode}
`),o(t.headers)),r){this.logStream.write("ERROR BODY:\n");var i=JSON.stringify(r,null,"	");this.logStream.write(`${i}
`)}}}traceOn(e){e||(e=o.stdout),this.logStream=e}traceOff(){this.logStream=null}makeRequest(e,t,r,o,i,n){if(!(0,v.isObject)(e))throw TypeError('options should be of type "object"');if(!(0,v.isString)(t)&&!(0,v.isObject)(t))throw TypeError('payload should be of type "string" or "Buffer"');if(r.forEach(e=>{if(!(0,v.isNumber)(e))throw TypeError('statusCode should be of type "number"')}),!(0,v.isString)(o))throw TypeError('region should be of type "string"');if(!(0,v.isBoolean)(i))throw TypeError('returnResponse should be of type "boolean"');if(!(0,v.isFunction)(n))throw TypeError('callback should be of type "function"');e.headers||(e.headers={}),("POST"===e.method||"PUT"===e.method||"DELETE"===e.method)&&(e.headers["content-length"]=t.length);var a="";this.enableSHA256&&(a=(0,v.toSha256)(t));var s=(0,v.readableStream)(t);this.makeRequestStream(e,s,a,r,o,i,n)}makeRequestStream(e,t,r,o,i,n,a){if(!(0,v.isObject)(e))throw TypeError('options should be of type "object"');if(!(0,v.isReadableStream)(t))throw new y.InvalidArgumentError("stream should be a readable Stream");if(!(0,v.isString)(r))throw TypeError('sha256sum should be of type "string"');if(o.forEach(e=>{if(!(0,v.isNumber)(e))throw TypeError('statusCode should be of type "number"')}),!(0,v.isString)(i))throw TypeError('region should be of type "string"');if(!(0,v.isBoolean)(n))throw TypeError('returnResponse should be of type "boolean"');if(!(0,v.isFunction)(a))throw TypeError('callback should be of type "function"');if(!this.enableSHA256&&0!==r.length)throw new y.InvalidArgumentError("sha256sum expected to be empty for anonymous or https requests");if(this.enableSHA256&&64!==r.length)throw new y.InvalidArgumentError(`Invalid sha256sum : ${r}`);var s=(i,s)=>{if(i)return a(i);e.region=s;var l=this.getRequestOptions(e);if(!this.anonymous){this.enableSHA256||(r="UNSIGNED-PAYLOAD");let e=new Date;l.headers["x-amz-date"]=(0,v.makeDateLong)(e),l.headers["x-amz-content-sha256"]=r,this.sessionToken&&(l.headers["x-amz-security-token"]=this.sessionToken),this.checkAndRefreshCreds();var u=(0,N.signV4)(l,this.accessKey,this.secretKey,s,e,r);l.headers.authorization=u}var c=this.transport.request(l,t=>{if(!o.includes(t.statusCode)){delete this.regionMap[e.bucketName];var r=B.getErrorTransformer(t);(0,v.pipesetup)(t,r).on("error",e=>{this.logHTTP(l,t,e),a(e)});return}if(this.logHTTP(l,t),n)return a(null,t);t.on("data",()=>{}),a(null)});(0,v.pipesetup)(t,c).on("error",e=>{this.logHTTP(l,null,e),a(e)})};if(i)return s(null,i);this.getBucketRegion(e.bucketName,s)}getBucketRegion(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError(`Invalid bucket name : ${e}`);if(!(0,v.isFunction)(t))throw TypeError('cb should be of type "function"');if(this.region)return t(null,this.region);if(this.regionMap[e])return t(null,this.regionMap[e]);var r=r=>{var o=B.getBucketRegionTransformer(),i=g.DEFAULT_REGION;(0,v.pipesetup)(r,o).on("error",t).on("data",e=>{e&&(i=e)}).on("end",()=>{this.regionMap[e]=i,t(null,i)})},o="location",i=this.pathStyle&&"undefined"==typeof window;this.makeRequest({method:"GET",bucketName:e,query:o,pathStyle:i},"",[200],g.DEFAULT_REGION,!0,(i,n)=>{if(i){if("AuthorizationHeaderMalformed"===i.name){var a=i.Region;return a?void this.makeRequest({method:"GET",bucketName:e,query:o},"",[200],a,!0,(e,o)=>{if(e)return t(e);r(o)}):t(i)}return t(i)}r(n)})}makeBucket(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if((0,v.isObject)(t)&&(o=r,r=t,t=""),(0,v.isFunction)(t)&&(o=t,t="",r={}),(0,v.isFunction)(r)&&(o=r,r={}),!(0,v.isString)(t))throw TypeError('region should be of type "string"');if(!(0,v.isObject)(r))throw TypeError('makeOpts should be of type "object"');if(!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');var i="";if(t&&this.region&&t!==this.region)throw new y.InvalidArgumentError(`Configured region ${this.region}, requested ${t}`);if(t&&t!==g.DEFAULT_REGION){var n=[];n.push({_attr:{xmlns:"http://s3.amazonaws.com/doc/2006-03-01/"}}),n.push({LocationConstraint:t}),i=m({CreateBucketConfiguration:n})}var a={};r.ObjectLocking&&(a["x-amz-bucket-object-lock-enabled"]=!0),t||(t=g.DEFAULT_REGION),this.makeRequest({method:"PUT",bucketName:e,headers:a},i,[200],t,!1,r=>(r&&(""===t||t===g.DEFAULT_REGION)&&"AuthorizationHeaderMalformed"===r.code&&""!==r.region&&this.makeRequest({method:"PUT",bucketName:e,headers:a},i,[200],r.region,!1,o),o&&o(r)))}listBuckets(e){if(!(0,v.isFunction)(e))throw TypeError('callback should be of type "function"');this.makeRequest({method:"GET"},"",[200],g.DEFAULT_REGION,!0,(t,r)=>{if(t)return e(t);var o,i=B.getListBucketTransformer();(0,v.pipesetup)(r,i).on("data",e=>o=e).on("error",t=>e(t)).on("end",()=>e(null,o))})}listIncompleteUploads(e,t,r){if(void 0===t&&(t=""),void 0===r&&(r=!1),!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidPrefix)(t))throw new y.InvalidPrefixError(`Invalid prefix : ${t}`);if(!(0,v.isBoolean)(r))throw TypeError('recursive should be of type "boolean"');var o=r?"":"/",i="",n="",a=[],s=!1,c=l.Readable({objectMode:!0});return c._read=()=>a.length?c.push(a.shift()):s?c.push(null):void this.listIncompleteUploadsQuery(e,t,i,n,o).on("error",e=>c.emit("error",e)).on("data",t=>{t.prefixes.forEach(e=>a.push(e)),u.eachSeries(t.uploads,(t,r)=>{this.listParts(e,t.key,t.uploadId,(e,o)=>{if(e)return r(e);t.size=o.reduce((e,t)=>e+t.size,0),a.push(t),r()})},e=>{if(e){c.emit("error",e);return}t.isTruncated?(i=t.nextKeyMarker,n=t.nextUploadIdMarker):s=!0,c._read()})}),c}bucketExists(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw TypeError('callback should be of type "function"');this.makeRequest({method:"HEAD",bucketName:e},"",[200],"",!1,e=>{if(e)return"NoSuchBucket"==e.code||"NotFound"==e.code?t(null,!1):t(e);t(null,!0)})}removeBucket(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw TypeError('callback should be of type "function"');this.makeRequest({method:"DELETE",bucketName:e},"",[204],"",!1,r=>{r||delete this.regionMap[e],t(r)})}removeIncompleteUpload(e,t,r){var o;if(!(0,v.isValidBucketName)(e))throw new y.IsValidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');u.during(r=>{this.findUploadId(e,t,(e,t)=>{if(e)return r(e);o=t,r(null,t)})},r=>{var i=`uploadId=${o}`;this.makeRequest({method:"DELETE",bucketName:e,objectName:t,query:i},"",[204],"",!1,e=>r(e))},r)}fGetObject(e,t,r,o={},i){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isString)(r))throw TypeError('filePath should be of type "string"');if((0,v.isFunction)(o)&&(i=o,o={}),!(0,v.isFunction)(i))throw TypeError('callback should be of type "function"');var n,l,c,p=e=>{if(e)return i(e);a.rename(n,r,i)};u.waterfall([r=>this.statObject(e,t,o,r),(e,t)=>{c=e,a.mkdir(s.dirname(r),{recursive:!0},e=>t(e))},i=>{n=`${r}.${c.etag}.part.minio`,a.stat(n,(r,s)=>{var u=0;if(r)l=a.createWriteStream(n,{flags:"w"});else{if(c.size===s.size)return p();u=s.size,l=a.createWriteStream(n,{flags:"a"})}this.getPartialObject(e,t,u,0,o,i)})},(e,t)=>{(0,v.pipesetup)(e,l).on("error",e=>t(e)).on("finish",t)},e=>a.stat(n,e),(e,t)=>{if(e.size===c.size)return t();t(Error("Size mismatch between downloaded file and the object"))}],p)}getObject(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if((0,v.isFunction)(r)&&(o=r,r={}),!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');this.getPartialObject(e,t,0,0,r,o)}getPartialObject(e,t,r,o,i={},n){if((0,v.isFunction)(o)&&(n=o,o=0),!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isNumber)(r))throw TypeError('offset should be of type "number"');if(!(0,v.isNumber)(o))throw TypeError('length should be of type "number"');if((0,v.isFunction)(i)&&(n=i,i={}),!(0,v.isFunction)(n))throw TypeError('callback should be of type "function"');var a="";(r||o)&&(r?a=`bytes=${+r}-`:(a="bytes=0-",r=0),o&&(a+=`${+o+r-1}`));var s={};""!==a&&(s.range=a);var l=[200];a&&l.push(206);var u=d.stringify(i);this.makeRequest({method:"GET",bucketName:e,objectName:t,headers:s,query:u},"",l,"",!0,n)}fPutObject(e,t,r,o,n){var s,l;if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isString)(r))throw TypeError('filePath should be of type "string"');if((0,v.isFunction)(o)&&(n=o,o={}),!(0,v.isObject)(o))throw TypeError('metaData should be of type "object"');o=(0,v.insertContentType)(o,r),o=(0,v.prependXAMZMeta)(o),u.waterfall([e=>a.stat(r,e),(i,l)=>{s=i.size;var u,c=!1,p=l;if(l=function(){if(!c)return c=!0,u&&u.destroy(),p.apply(this,arguments)},s>this.maxObjectSize)return l(Error(`${r} size : ${i.size}, max allowed size : 5TB`));if(s<=this.partSize){var d=this.getUploader(e,t,o,!1),f=B.getHashSummer(this.enableSHA256),m=s-1;0===s&&(m=0);var h={start:0,end:m,autoClose:!0};(0,v.pipesetup)(a.createReadStream(r,h),f).on("data",e=>{var t=e.md5sum,o=e.sha256sum;d(u=a.createReadStream(r,h),s,o,t,(e,t)=>{n(e,t),l(!0)})}).on("error",e=>l(e));return}this.findUploadId(e,t,l)},(r,i)=>{if(r)return this.listParts(e,t,r,(e,t)=>i(e,r,t));this.initiateNewMultipartUpload(e,t,o,(e,t)=>i(e,t,[]))},(n,c,p)=>{l=this.calculatePartSize(s);var d=this.getUploader(e,t,o,!0),f=c.reduce(function(e,t){return e[t.part]||(e[t.part]=t),e},{}),m=[],h=1,y=0;u.whilst(e=>{e(null,y<s)},e=>{var t,o=!1,u=e;e=function(){if(!o)return o=!0,t&&t.destroy(),u.apply(this,arguments)};var c=f[h],p=B.getHashSummer(this.enableSHA256),b=l;b>s-y&&(b=s-y);var g={autoClose:!0,start:y,end:y+b-1};(0,v.pipesetup)(a.createReadStream(r,g),p).on("data",o=>{var s=i.from(o.md5sum,"base64").toString("hex");if(c&&s===c.etag)return m.push({part:h,etag:c.etag}),h++,y+=b,e();d(n,h,t=a.createReadStream(r,g),b,o.sha256sum,o.md5sum,(t,r)=>t?e(t):(m.push({part:h,etag:r.etag}),h++,y+=b,e()))}).on("error",t=>e(t))},e=>{if(e)return p(e);p(null,m,n)})},(r,o,i)=>this.completeMultipartUpload(e,t,o,r,i)],(e,...t)=>{!0!==e&&n(e,...t)})}putObject(e,t,r,o,n,a){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if((0,v.isFunction)(o)?(a=o,n={}):(0,v.isFunction)(n)&&(a=n,n={}),(0,v.isObject)(o)&&(n=o),n=(0,v.prependXAMZMeta)(n),"string"==typeof r||r instanceof i)o=r.length,r=(0,v.readableStream)(r);else if(!(0,v.isReadableStream)(r))throw TypeError('third argument should be of type "stream.Readable" or "Buffer" or "string"');if(!(0,v.isFunction)(a))throw TypeError('callback should be of type "function"');if((0,v.isNumber)(o)&&o<0)throw new y.InvalidArgumentError(`size cannot be negative, given size: ${o}`);(0,v.isNumber)(o)||(o=this.maxObjectSize),o=this.calculatePartSize(o);let s=new c({size:o,zeroPadding:!1}),l=new O.ObjectUploader(this,e,t,o,n,a);(0,v.pipesetup)(r,s,l)}copyObjectV1(e,t,r,o,i){if("function"==typeof o&&void 0===i?(n=null,a=o):(n=o,a=i),!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isString)(r))throw TypeError('srcObject should be of type "string"');if(""===r)throw new y.InvalidPrefixError("Empty source prefix");if(null!==n&&!(n instanceof w.CopyConditions))throw TypeError('conditions should be of type "CopyConditions"');var n,a,s={};s["x-amz-copy-source"]=(0,v.uriResourceEscape)(r),null!==n&&(""!==n.modified&&(s["x-amz-copy-source-if-modified-since"]=n.modified),""!==n.unmodified&&(s["x-amz-copy-source-if-unmodified-since"]=n.unmodified),""!==n.matchETag&&(s["x-amz-copy-source-if-match"]=n.matchETag),""!==n.matchEtagExcept&&(s["x-amz-copy-source-if-none-match"]=n.matchETagExcept)),this.makeRequest({method:"PUT",bucketName:e,objectName:t,headers:s},"",[200],"",!0,(e,t)=>{if(e)return a(e);var r=B.getCopyObjectTransformer();(0,v.pipesetup)(t,r).on("error",e=>a(e)).on("data",e=>a(null,e))})}copyObjectV2(e,t,r){if(!(e instanceof g.CopySourceOptions))throw new y.InvalidArgumentError("sourceConfig should of type CopySourceOptions ");if(!(t instanceof g.CopyDestinationOptions))throw new y.InvalidArgumentError("destConfig should of type CopyDestinationOptions ");if(!t.validate()||!t.validate())return!1;if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');let o=Object.assign({},e.getHeaders(),t.getHeaders()),i=t.Bucket,n=t.Object;this.makeRequest({method:"PUT",bucketName:i,objectName:n,headers:o},"",[200],"",!0,(e,o)=>{if(e)return r(e);let i=B.getCopyObjectTransformer();(0,v.pipesetup)(o,i).on("error",e=>r(e)).on("data",e=>{let i=o.headers,n={Bucket:t.Bucket,Key:t.Object,LastModified:e.LastModified,MetaData:(0,v.extractMetadata)(i),VersionId:(0,v.getVersionId)(i),SourceVersionId:(0,v.getSourceVersionId)(i),Etag:(0,v.sanitizeETag)(i.etag),Size:+i["content-length"]};return r(null,n)})})}copyObject(...e){return e[0]instanceof g.CopySourceOptions&&e[1]instanceof g.CopyDestinationOptions?this.copyObjectV2(...arguments):this.copyObjectV1(...arguments)}listObjectsQuery(e,t,r,o={}){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isString)(t))throw TypeError('prefix should be of type "string"');if(!(0,v.isString)(r))throw TypeError('marker should be of type "string"');let{Delimiter:i,MaxKeys:n,IncludeVersion:a}=o;if(!(0,v.isObject)(o))throw TypeError('listQueryOpts should be of type "object"');if(!(0,v.isString)(i))throw TypeError('Delimiter should be of type "string"');if(!(0,v.isNumber)(n))throw TypeError('MaxKeys should be of type "number"');let s=[];s.push(`prefix=${(0,v.uriEscape)(t)}`),s.push(`delimiter=${(0,v.uriEscape)(i)}`),s.push("encoding-type=url"),a&&s.push("versions"),r&&(r=(0,v.uriEscape)(r),a?s.push(`key-marker=${r}`):s.push(`marker=${r}`)),n&&(n>=1e3&&(n=1e3),s.push(`max-keys=${n}`)),s.sort();var l="";s.length>0&&(l=`${s.join("&")}`);var u=B.getListObjectsTransformer();return this.makeRequest({method:"GET",bucketName:e,query:l},"",[200],"",!0,(e,t)=>{if(e)return u.emit("error",e);(0,v.pipesetup)(t,u)}),u}listObjects(e,t,r,o={}){if(void 0===t&&(t=""),void 0===r&&(r=!1),!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidPrefix)(t))throw new y.InvalidPrefixError(`Invalid prefix : ${t}`);if(!(0,v.isString)(t))throw TypeError('prefix should be of type "string"');if(!(0,v.isBoolean)(r))throw TypeError('recursive should be of type "boolean"');if(!(0,v.isObject)(o))throw TypeError('listOpts should be of type "object"');var i="";let n={Delimiter:r?"":"/",MaxKeys:1e3,IncludeVersion:o.IncludeVersion};var a=[],s=!1,u=l.Readable({objectMode:!0});return u._read=()=>{if(a.length){u.push(a.shift());return}if(s)return u.push(null);this.listObjectsQuery(e,t,i,n).on("error",e=>u.emit("error",e)).on("data",e=>{e.isTruncated?i=e.nextMarker||e.versionIdMarker:s=!0,a=e.objects,u._read()})},u}listObjectsV2Query(e,t,r,o,i,n){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isString)(t))throw TypeError('prefix should be of type "string"');if(!(0,v.isString)(r))throw TypeError('continuationToken should be of type "string"');if(!(0,v.isString)(o))throw TypeError('delimiter should be of type "string"');if(!(0,v.isNumber)(i))throw TypeError('maxKeys should be of type "number"');if(!(0,v.isString)(n))throw TypeError('startAfter should be of type "string"');var a=[];a.push("list-type=2"),a.push("encoding-type=url"),a.push(`prefix=${(0,v.uriEscape)(t)}`),a.push(`delimiter=${(0,v.uriEscape)(o)}`),r&&a.push(`continuation-token=${r=(0,v.uriEscape)(r)}`),n&&a.push(`start-after=${n=(0,v.uriEscape)(n)}`),i&&(i>=1e3&&(i=1e3),a.push(`max-keys=${i}`)),a.sort();var s="";a.length>0&&(s=`${a.join("&")}`);var l=B.getListObjectsV2Transformer();return this.makeRequest({method:"GET",bucketName:e,query:s},"",[200],"",!0,(e,t)=>{if(e)return l.emit("error",e);(0,v.pipesetup)(t,l)}),l}listObjectsV2(e,t,r,o){if(void 0===t&&(t=""),void 0===r&&(r=!1),void 0===o&&(o=""),!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidPrefix)(t))throw new y.InvalidPrefixError(`Invalid prefix : ${t}`);if(!(0,v.isString)(t))throw TypeError('prefix should be of type "string"');if(!(0,v.isBoolean)(r))throw TypeError('recursive should be of type "boolean"');if(!(0,v.isString)(o))throw TypeError('startAfter should be of type "string"');var i=r?"":"/",n="",a=[],s=!1,u=l.Readable({objectMode:!0});return u._read=()=>{if(a.length){u.push(a.shift());return}if(s)return u.push(null);this.listObjectsV2Query(e,t,n,i,1e3,o).on("error",e=>u.emit("error",e)).on("data",e=>{e.isTruncated?n=e.nextContinuationToken:s=!0,a=e.objects,u._read()})},u}statObject(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if((0,v.isFunction)(r)&&(o=r,r={}),!(0,v.isObject)(r))throw new y.InvalidArgumentError('statOpts should be of type "object"');if(!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');var i=d.stringify(r);this.makeRequest({method:"HEAD",bucketName:e,objectName:t,query:i},"",[200],"",!0,(e,t)=>{if(e)return o(e);t.on("data",()=>{});let r={size:+t.headers["content-length"],metaData:(0,v.extractMetadata)(t.headers),lastModified:new Date(t.headers["last-modified"]),versionId:(0,v.getVersionId)(t.headers),etag:(0,v.sanitizeETag)(t.headers.etag)};o(null,r)})}removeObject(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if((0,v.isFunction)(r)&&(o=r,r={}),!(0,v.isObject)(r))throw new y.InvalidArgumentError('removeOpts should be of type "object"');if(!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');let i={};r.versionId&&(i.versionId=`${r.versionId}`);let n={};r.governanceBypass&&(n["X-Amz-Bypass-Governance-Retention"]=!0),r.forceDelete&&(n["x-minio-force-delete"]=!0);let a=d.stringify(i),s={method:"DELETE",bucketName:e,objectName:t,headers:n};a&&(s.query=a),this.makeRequest(s,"",[200,204],"",!1,o)}removeObjects(e,t,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!Array.isArray(t))throw new y.InvalidArgumentError("objectsList should be a list");if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');let o=t.reduce((e,t)=>(e.list.push(t),1e3===e.list.length&&(e.listOfList.push(e.list),e.list=[]),e),{listOfList:[],list:[]});o.list.length>0&&o.listOfList.push(o.list);let i=new f.TextEncoder,n=[];u.eachSeries(o.listOfList,(t,r)=>{let o;var a=[];t.forEach(function(e){(0,v.isObject)(e)?a.push({Key:e.name,VersionId:e.versionId}):a.push({Key:e})});let s=new h.Builder({headless:!0}),l=s.buildObject({Delete:{Quiet:!0,Object:a}});l=i.encode(l);let u={};u["Content-MD5"]=(0,v.toMd5)(l),this.makeRequest({method:"POST",bucketName:e,query:"delete",headers:u},l,[200],"",!0,(e,t)=>{if(e)return r(e);(0,v.pipesetup)(t,B.removeObjectsTransformer()).on("data",e=>{o=e}).on("error",e=>r(e,null)).on("end",()=>(n.push(o),r(null,o)))})},()=>{r(null,p.flatten(n))})}getBucketPolicy(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError(`Invalid bucket name: ${e}`);if(!(0,v.isFunction)(t))throw TypeError('callback should be of type "function"');this.makeRequest({method:"GET",bucketName:e,query:"policy"},"",[200],"",!0,(e,r)=>{if(e)return t(e);let o=i.from("");(0,v.pipesetup)(r,B.getConcater()).on("data",e=>o=e).on("error",t).on("end",()=>{t(null,o.toString())})})}setBucketPolicy(e,t,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError(`Invalid bucket name: ${e}`);if(!(0,v.isString)(t))throw new y.InvalidBucketPolicyError(`Invalid bucket policy: ${t} - must be "string"`);if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');let o="DELETE";t&&(o="PUT"),this.makeRequest({method:o,bucketName:e,query:"policy"},t,[204],"",!1,r)}presignedUrl(e,t,r,o,i,n,a){if(this.anonymous)throw new y.AnonymousRequestError("Presigned "+e+" url cannot be generated for anonymous requests");if((0,v.isFunction)(n)&&(a=n,n=new Date),(0,v.isFunction)(i)&&(a=i,i={},n=new Date),(0,v.isFunction)(o)&&(a=o,i={},o=604800,n=new Date),!(0,v.isNumber)(o))throw TypeError('expires should be of type "number"');if(!(0,v.isObject)(i))throw TypeError('reqParams should be of type "object"');if(!(0,v.isValidDate)(n))throw TypeError('requestDate should be of type "Date" and valid');if(!(0,v.isFunction)(a))throw TypeError('callback should be of type "function"');var s=d.stringify(i);this.getBucketRegion(t,(i,l)=>{if(i)return a(i);var u,c=this.getRequestOptions({method:e,region:l,bucketName:t,objectName:r,query:s});this.checkAndRefreshCreds();try{u=(0,N.presignSignatureV4)(c,this.accessKey,this.secretKey,this.sessionToken,l,n,o)}catch(e){return a(e)}a(null,u)})}presignedGetObject(e,t,r,o,i,n){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);return(0,v.isFunction)(o)&&(n=o,o={},i=new Date),["response-content-type","response-content-language","response-expires","response-cache-control","response-content-disposition","response-content-encoding"].forEach(e=>{if(void 0!==o&&void 0!==o[e]&&!(0,v.isString)(o[e]))throw TypeError(`response header ${e} should be of type "string"`)}),this.presignedUrl("GET",e,t,r,o,i,n)}presignedPutObject(e,t,r,o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError(`Invalid bucket name: ${e}`);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);return this.presignedUrl("PUT",e,t,r,o)}newPostPolicy(){return new k.PostPolicy}presignedPostPolicy(e,t){if(this.anonymous)throw new y.AnonymousRequestError("Presigned POST policy cannot be generated for anonymous requests");if(!(0,v.isObject)(e))throw TypeError('postPolicy should be of type "object"');if(!(0,v.isFunction)(t))throw TypeError('cb should be of type "function"');this.getBucketRegion(e.formData.bucket,(r,o)=>{if(r)return t(r);var n=new Date,a=(0,v.makeDateLong)(n);if(this.checkAndRefreshCreds(),!e.policy.expiration){var s=new Date;s.setSeconds(604800),e.setExpires(s)}e.policy.conditions.push(["eq","$x-amz-date",a]),e.formData["x-amz-date"]=a,e.policy.conditions.push(["eq","$x-amz-algorithm","AWS4-HMAC-SHA256"]),e.formData["x-amz-algorithm"]="AWS4-HMAC-SHA256",e.policy.conditions.push(["eq","$x-amz-credential",this.accessKey+"/"+(0,v.getScope)(o,n)]),e.formData["x-amz-credential"]=this.accessKey+"/"+(0,v.getScope)(o,n),this.sessionToken&&(e.policy.conditions.push(["eq","$x-amz-security-token",this.sessionToken]),e.formData["x-amz-security-token"]=this.sessionToken);var l=i.from(JSON.stringify(e.policy)).toString("base64");e.formData.policy=l;var u=(0,N.postPresignSignatureV4)(o,n,this.secretKey,l);e.formData["x-amz-signature"]=u;var c={};c.region=o,c.bucketName=e.formData.bucket;var p=this.getRequestOptions(c);t(null,{postURL:`${p.protocol}//${p.host}${80==this.port||443===this.port?"":`:${this.port.toString()}`}${p.path}`,formData:e.formData})})}initiateNewMultipartUpload(e,t,r,o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isObject)(r))throw new y.InvalidObjectNameError('contentType should be of type "object"');let i=Object.assign({},r);this.makeRequest({method:"POST",bucketName:e,objectName:t,query:"uploads",headers:i},"",[200],"",!0,(e,t)=>{if(e)return o(e);var r=B.getInitiateMultipartTransformer();(0,v.pipesetup)(t,r).on("error",e=>o(e)).on("data",e=>o(null,e))})}completeMultipartUpload(e,t,r,o,i){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isString)(r))throw TypeError('uploadId should be of type "string"');if(!(0,v.isObject)(o))throw TypeError('etags should be of type "Array"');if(!(0,v.isFunction)(i))throw TypeError('cb should be of type "function"');if(!r)throw new y.InvalidArgumentError("uploadId cannot be empty");var n=`uploadId=${(0,v.uriEscape)(r)}`,a=[];o.forEach(e=>{a.push({Part:[{PartNumber:e.part},{ETag:e.etag}]})});var s=m({CompleteMultipartUpload:a});this.makeRequest({method:"POST",bucketName:e,objectName:t,query:n},s,[200],"",!0,(e,t)=>{if(e)return i(e);var r=B.getCompleteMultipartTransformer();(0,v.pipesetup)(t,r).on("error",e=>i(e)).on("data",e=>{if(e.errCode)i(new y.S3Error(e.errMessage));else{let r={etag:e.etag,versionId:(0,v.getVersionId)(t.headers)};i(null,r)}})})}listParts(e,t,r,o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isString)(r))throw TypeError('uploadId should be of type "string"');if(!r)throw new y.InvalidArgumentError("uploadId cannot be empty");var i=[],n=a=>{this.listPartsQuery(e,t,r,a,(e,t)=>{if(e){o(e);return}if(i=i.concat(t.parts),t.isTruncated){n(t.marker);return}o(null,i)})};n(0)}listPartsQuery(e,t,r,o,i){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isString)(r))throw TypeError('uploadId should be of type "string"');if(!(0,v.isNumber)(o))throw TypeError('marker should be of type "number"');if(!(0,v.isFunction)(i))throw TypeError('callback should be of type "function"');if(!r)throw new y.InvalidArgumentError("uploadId cannot be empty");var n="";o&&0!==o&&(n+=`part-number-marker=${o}&`),n+=`uploadId=${(0,v.uriEscape)(r)}`,this.makeRequest({method:"GET",bucketName:e,objectName:t,query:n},"",[200],"",!0,(e,t)=>{if(e)return i(e);var r=B.getListPartsTransformer();(0,v.pipesetup)(t,r).on("error",e=>i(e)).on("data",e=>i(null,e))})}listIncompleteUploadsQuery(e,t,r,o,i){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isString)(t))throw TypeError('prefix should be of type "string"');if(!(0,v.isString)(r))throw TypeError('keyMarker should be of type "string"');if(!(0,v.isString)(o))throw TypeError('uploadIdMarker should be of type "string"');if(!(0,v.isString)(i))throw TypeError('delimiter should be of type "string"');var n=[];n.push(`prefix=${(0,v.uriEscape)(t)}`),n.push(`delimiter=${(0,v.uriEscape)(i)}`),r&&n.push(`key-marker=${r=(0,v.uriEscape)(r)}`),o&&n.push(`upload-id-marker=${o}`),n.push("max-uploads=1000"),n.sort(),n.unshift("uploads");var a="";n.length>0&&(a=`${n.join("&")}`);var s=B.getListMultipartTransformer();return this.makeRequest({method:"GET",bucketName:e,query:a},"",[200],"",!0,(e,t)=>{if(e)return s.emit("error",e);(0,v.pipesetup)(t,s)}),s}findUploadId(e,t,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isFunction)(r))throw TypeError('cb should be of type "function"');var o,i=(n,a)=>{this.listIncompleteUploadsQuery(e,t,n,a,"").on("error",e=>r(e)).on("data",e=>{if(e.uploads.forEach(e=>{if(e.key===t&&(!o||e.initiated.getTime()>o.initiated.getTime())){o=e;return}}),e.isTruncated){i(e.nextKeyMarker,e.nextUploadIdMarker);return}if(o)return r(null,o.uploadId);r(null,void 0)})};i("","")}getUploader(e,t,r,o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(!(0,v.isBoolean)(o))throw TypeError('multipart should be of type "boolean"');if(!(0,v.isObject)(r))throw TypeError('metadata should be of type "object"');var i=(e,t,r,o,i)=>{if(!(0,v.isReadableStream)(e))throw TypeError('stream should be of type "Stream"');if(!(0,v.isNumber)(t))throw TypeError('length should be of type "number"');if(!(0,v.isString)(r))throw TypeError('sha256sum should be of type "string"');if(!(0,v.isString)(o))throw TypeError('md5sum should be of type "string"');if(!(0,v.isFunction)(i))throw TypeError('callback should be of type "function"')},n=(i,n,a,s,l,u)=>{let c={"Content-Length":a};o||(c=Object.assign({},r,c)),this.enableSHA256||(c["Content-MD5"]=l),this.makeRequestStream({method:"PUT",bucketName:e,objectName:t,query:i,headers:c},n,s,[200],"",!0,(e,t)=>{if(e)return u(e);let r={etag:(0,v.sanitizeETag)(t.headers.etag),versionId:(0,v.getVersionId)(t.headers)};t.on("data",()=>{}),u(null,r)})};return o?(e,t,...r)=>{if(!(0,v.isString)(e))throw TypeError('uploadId should be of type "string"');if(!(0,v.isNumber)(t))throw TypeError('partNumber should be of type "number"');if(!e)throw new y.InvalidArgumentError("Empty uploadId");if(!t)throw new y.InvalidArgumentError("partNumber cannot be 0");i(...r),n(`partNumber=${t}&uploadId=${(0,v.uriEscape)(e)}`,...r)}:(...e)=>{i(...e),n("",...e)}}setBucketNotification(e,t,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isObject)(t))throw TypeError('notification config should be of type "Object"');if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');var o=new h.Builder({rootName:"NotificationConfiguration",renderOpts:{pretty:!1},headless:!0}).buildObject(t);this.makeRequest({method:"PUT",bucketName:e,query:"notification"},o,[200],"",!1,r)}removeAllBucketNotification(e,t){this.setBucketNotification(e,new T.NotificationConfig,t)}getBucketNotification(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw TypeError('callback should be of type "function"');this.makeRequest({method:"GET",bucketName:e,query:"notification"},"",[200],"",!0,(e,r)=>{if(e)return t(e);var o,i=B.getBucketNotificationTransformer();(0,v.pipesetup)(r,i).on("data",e=>o=e).on("error",e=>t(e)).on("end",()=>t(null,o))})}listenBucketNotification(e,t,r,o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError(`Invalid bucket name: ${e}`);if(!(0,v.isString)(t))throw TypeError("prefix must be of type string");if(!(0,v.isString)(r))throw TypeError("suffix must be of type string");if(!Array.isArray(o))throw TypeError("events must be of type Array");let i=new T.NotificationPoller(this,e,t,r,o);return i.start(),i}getBucketVersioning(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw new y.InvalidArgumentError('callback should be of type "function"');this.makeRequest({method:"GET",bucketName:e,query:"versioning"},"",[200],"",!0,(e,r)=>{if(e)return t(e);let o=i.from("");(0,v.pipesetup)(r,B.bucketVersioningTransformer()).on("data",e=>{o=e}).on("error",t).on("end",()=>{t(null,o)})})}setBucketVersioning(e,t,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!Object.keys(t).length)throw new y.InvalidArgumentError('versionConfig should be of type "object"');if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');var o=new h.Builder({rootName:"VersioningConfiguration",renderOpts:{pretty:!1},headless:!0}).buildObject(t);this.makeRequest({method:"PUT",bucketName:e,query:"versioning"},o,[200],"",!1,r)}setTagging(e){let{bucketName:t,objectName:r,tags:o,putOpts:i={},cb:n}=e,a="tagging";i&&i.versionId&&(a=`${a}&versionId=${i.versionId}`);let s=[];for(let[e,t]of Object.entries(o))s.push({Key:e,Value:t});let l=new f.TextEncoder,u={},c=new h.Builder({headless:!0,renderOpts:{pretty:!1}}),p=c.buildObject({Tagging:{TagSet:{Tag:s}}});p=l.encode(p),u["Content-MD5"]=(0,v.toMd5)(p);let d={method:"PUT",bucketName:t,query:a,headers:u};r&&(d.objectName=r),u["Content-MD5"]=(0,v.toMd5)(p),this.makeRequest(d,p,[200],"",!1,n)}setBucketTagging(e,t,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isObject)(t))throw new y.InvalidArgumentError('tags should be of type "object"');if(Object.keys(t).length>10)throw new y.InvalidArgumentError('maximum tags allowed is 10"');if(!(0,v.isFunction)(r))throw new y.InvalidArgumentError('callback should be of type "function"');return this.setTagging({bucketName:e,tags:t,cb:r})}setObjectTagging(e,t,r,o={},i){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidBucketNameError("Invalid object name: "+t);if((0,v.isFunction)(o)&&(i=o,o={}),!(0,v.isObject)(r))throw new y.InvalidArgumentError('tags should be of type "object"');if(Object.keys(r).length>10)throw new y.InvalidArgumentError('Maximum tags allowed is 10"');if(!(0,v.isFunction)(i))throw TypeError('callback should be of type "function"');return this.setTagging({bucketName:e,objectName:t,tags:r,putOpts:o,cb:i})}removeTagging({bucketName:e,objectName:t,removeOpts:r,cb:o}){let i="tagging";r&&Object.keys(r).length&&r.versionId&&(i=`${i}&versionId=${r.versionId}`);let n={method:"DELETE",bucketName:e,objectName:t,query:i};t&&(n.objectName=t),this.makeRequest(n,"",[200,204],"",!0,o)}removeBucketTagging(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw TypeError('callback should be of type "function"');return this.removeTagging({bucketName:e,cb:t})}removeObjectTagging(e,t,r,o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidBucketNameError("Invalid object name: "+t);if((0,v.isFunction)(r)&&(o=r,r={}),r&&Object.keys(r).length&&!(0,v.isObject)(r))throw new y.InvalidArgumentError('removeOpts should be of type "object"');if(!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');return this.removeTagging({bucketName:e,objectName:t,removeOpts:r,cb:o})}getBucketTagging(e,t){this.makeRequest({method:"GET",bucketName:e,query:"tagging"},"",[200],"",!0,(e,r)=>{let o;var i=B.getTagsTransformer();if(e)return t(e);(0,v.pipesetup)(r,i).on("data",e=>o=e).on("error",e=>t(e)).on("end",()=>t(null,o))})}getObjectTagging(e,t,r={},o=()=>!1){let i="tagging";if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidBucketNameError("Invalid object name: "+t);if((0,v.isFunction)(r)&&(o=r,r={}),!(0,v.isObject)(r))throw new y.InvalidArgumentError('getOpts should be of type "object"');if(!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');r&&r.versionId&&(i=`${i}&versionId=${r.versionId}`);let n={method:"GET",bucketName:e,query:i};t&&(n.objectName=t),this.makeRequest(n,"",[200],"",!0,(e,t)=>{let r;let i=B.getTagsTransformer();if(e)return o(e);(0,v.pipesetup)(t,i).on("data",e=>r=e).on("error",e=>o(e)).on("end",()=>o(null,r))})}applyBucketLifecycle(e,t,r){let o=new f.TextEncoder,i={},n=new h.Builder({rootName:"LifecycleConfiguration",headless:!0,renderOpts:{pretty:!1}}),a=n.buildObject(t);a=o.encode(a),i["Content-MD5"]=(0,v.toMd5)(a),this.makeRequest({method:"PUT",bucketName:e,query:"lifecycle",headers:i},a,[200],"",!1,r)}removeBucketLifecycle(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);this.makeRequest({method:"DELETE",bucketName:e,query:"lifecycle"},"",[204],"",!1,t)}setBucketLifecycle(e,t=null,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);p.isEmpty(t)?this.removeBucketLifecycle(e,r):this.applyBucketLifecycle(e,t,r)}getBucketLifecycle(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);this.makeRequest({method:"GET",bucketName:e,query:"lifecycle"},"",[200],"",!0,(e,r)=>{let o;let i=B.lifecycleTransformer();if(e)return t(e);(0,v.pipesetup)(r,i).on("data",e=>o=e).on("error",e=>t(e)).on("end",()=>t(null,o))})}setObjectLockConfig(e,t={},r){let o=[I.RETENTION_MODES.COMPLIANCE,I.RETENTION_MODES.GOVERNANCE],i=[I.RETENTION_VALIDITY_UNITS.DAYS,I.RETENTION_VALIDITY_UNITS.YEARS];if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(t.mode&&!o.includes(t.mode))throw TypeError(`lockConfigOpts.mode should be one of ${o}`);if(t.unit&&!i.includes(t.unit))throw TypeError(`lockConfigOpts.unit should be one of ${i}`);if(t.validity&&!(0,v.isNumber)(t.validity))throw TypeError("lockConfigOpts.validity should be a number");let n={ObjectLockEnabled:"Enabled"},a=Object.keys(t);if(a.length>0){if(0!==p.difference(a,["unit","mode","validity"]).length)throw TypeError("lockConfigOpts.mode,lockConfigOpts.unit,lockConfigOpts.validity all the properties should be specified.");n.Rule={DefaultRetention:{}},t.mode&&(n.Rule.DefaultRetention.Mode=t.mode),t.unit===I.RETENTION_VALIDITY_UNITS.DAYS?n.Rule.DefaultRetention.Days=t.validity:t.unit===I.RETENTION_VALIDITY_UNITS.YEARS&&(n.Rule.DefaultRetention.Years=t.validity)}let s=new h.Builder({rootName:"ObjectLockConfiguration",renderOpts:{pretty:!1},headless:!0}),l=s.buildObject(n),u={};u["Content-MD5"]=(0,v.toMd5)(l),this.makeRequest({method:"PUT",bucketName:e,query:"object-lock",headers:u},l,[200],"",!1,r)}getObjectLockConfig(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw new y.InvalidArgumentError('callback should be of type "function"');this.makeRequest({method:"GET",bucketName:e,query:"object-lock"},"",[200],"",!0,(e,r)=>{if(e)return t(e);let o=i.from("");(0,v.pipesetup)(r,B.objectLockTransformer()).on("data",e=>{o=e}).on("error",t).on("end",()=>{t(null,o)})})}putObjectRetention(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if((0,v.isObject)(r)){if(r.governanceBypass&&!(0,v.isBoolean)(r.governanceBypass))throw new y.InvalidArgumentError("Invalid value for governanceBypass",r.governanceBypass);if(r.mode&&![I.RETENTION_MODES.COMPLIANCE,I.RETENTION_MODES.GOVERNANCE].includes(r.mode))throw new y.InvalidArgumentError("Invalid object retention mode ",r.mode);if(r.retainUntilDate&&!(0,v.isString)(r.retainUntilDate))throw new y.InvalidArgumentError("Invalid value for retainUntilDate",r.retainUntilDate);if(r.versionId&&!(0,v.isString)(r.versionId))throw new y.InvalidArgumentError("Invalid value for versionId",r.versionId)}else throw new y.InvalidArgumentError('retentionOpts should be of type "object"');if(!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');let i="retention",n={};r.governanceBypass&&(n["X-Amz-Bypass-Governance-Retention"]=!0);let a=new h.Builder({rootName:"Retention",renderOpts:{pretty:!1},headless:!0}),s={};r.mode&&(s.Mode=r.mode),r.retainUntilDate&&(s.RetainUntilDate=r.retainUntilDate),r.versionId&&(i+=`&versionId=${r.versionId}`);let l=a.buildObject(s);n["Content-MD5"]=(0,v.toMd5)(l),this.makeRequest({method:"PUT",bucketName:e,objectName:t,query:i,headers:n},l,[200,204],"",!1,o)}getObjectRetention(e,t,r,o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if((0,v.isObject)(r)){if(r.versionId&&!(0,v.isString)(r.versionId))throw new y.InvalidArgumentError('VersionID should be of type "string"')}else throw new y.InvalidArgumentError('callback should be of type "object"');if(o&&!(0,v.isFunction)(o))throw new y.InvalidArgumentError('callback should be of type "function"');let n="retention";r.versionId&&(n+=`&versionId=${r.versionId}`),this.makeRequest({method:"GET",bucketName:e,objectName:t,query:n},"",[200],"",!0,(e,t)=>{if(e)return o(e);let r=i.from("");(0,v.pipesetup)(t,B.objectRetentionTransformer()).on("data",e=>{r=e}).on("error",o).on("end",()=>{o(null,r)})})}setBucketEncryption(e,t,r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if((0,v.isFunction)(t)&&(r=t,t=null),!p.isEmpty(t)&&t.Rule.length>1)throw new y.InvalidArgumentError("Invalid Rule length. Only one rule is allowed.: "+t.Rule);if(r&&!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');let o=t;p.isEmpty(t)&&(o={Rule:[{ApplyServerSideEncryptionByDefault:{SSEAlgorithm:"AES256"}}]});let i=new h.Builder({rootName:"ServerSideEncryptionConfiguration",renderOpts:{pretty:!1},headless:!0}).buildObject(o),n={};n["Content-MD5"]=(0,v.toMd5)(i),this.makeRequest({method:"PUT",bucketName:e,query:"encryption",headers:n},i,[200],"",!1,r)}getBucketEncryption(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw new y.InvalidArgumentError('callback should be of type "function"');this.makeRequest({method:"GET",bucketName:e,query:"encryption"},"",[200],"",!0,(e,r)=>{if(e)return t(e);let o=i.from("");(0,v.pipesetup)(r,B.bucketEncryptionTransformer()).on("data",e=>{o=e}).on("error",t).on("end",()=>{t(null,o)})})}removeBucketEncryption(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw new y.InvalidArgumentError('callback should be of type "function"');this.makeRequest({method:"DELETE",bucketName:e,query:"encryption"},"",[204],"",!1,t)}setBucketReplication(e,t={},r){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if((0,v.isObject)(t)){if(p.isEmpty(t.role))throw new y.InvalidArgumentError("Role cannot be empty");if(t.role&&!(0,v.isString)(t.role))throw new y.InvalidArgumentError("Invalid value for role",t.role);if(p.isEmpty(t.rules))throw new y.InvalidArgumentError("Minimum one replication rule must be specified")}else throw new y.InvalidArgumentError('replicationConfig should be of type "object"');if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');let o={},i={ReplicationConfiguration:{Role:t.role,Rule:t.rules}},n=new h.Builder({renderOpts:{pretty:!1},headless:!0}),a=n.buildObject(i);o["Content-MD5"]=(0,v.toMd5)(a),this.makeRequest({method:"PUT",bucketName:e,query:"replication",headers:o},a,[200],"",!1,r)}getBucketReplication(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isFunction)(t))throw new y.InvalidArgumentError('callback should be of type "function"');this.makeRequest({method:"GET",bucketName:e,query:"replication"},"",[200],"",!0,(e,r)=>{if(e)return t(e);let o=i.from("");(0,v.pipesetup)(r,B.replicationConfigTransformer()).on("data",e=>{o=e}).on("error",t).on("end",()=>{t(null,o)})})}removeBucketReplication(e,t){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);this.makeRequest({method:"DELETE",bucketName:e,query:"replication"},"",[200,204],"",!1,t)}getObjectLegalHold(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if((0,v.isFunction)(r)&&(o=r,r={}),(0,v.isObject)(r)){if(Object.keys(r).length>0&&r.versionId&&!(0,v.isString)(r.versionId))throw TypeError("versionId should be of type string.:",r.versionId)}else throw TypeError('getOpts should be of type "Object"');if(!(0,v.isFunction)(o))throw new y.InvalidArgumentError('callback should be of type "function"');let n="legal-hold";r.versionId&&(n+=`&versionId=${r.versionId}`),this.makeRequest({method:"GET",bucketName:e,objectName:t,query:n},"",[200],"",!0,(e,t)=>{if(e)return o(e);let r=i.from("");(0,v.pipesetup)(t,B.objectLegalHoldTransformer()).on("data",e=>{r=e}).on("error",o).on("end",()=>{o(null,r)})})}setObjectLegalHold(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError("Invalid bucket name: "+e);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);let i={status:I.LEGAL_HOLD_STATUS.ENABLED};if((0,v.isFunction)(r)&&(o=r,r=i),(0,v.isObject)(r)){if(![I.LEGAL_HOLD_STATUS.ENABLED,I.LEGAL_HOLD_STATUS.DISABLED].includes(r.status))throw TypeError("Invalid status: "+r.status);if(r.versionId&&!r.versionId.length)throw TypeError("versionId should be of type string.:"+r.versionId)}else throw TypeError('setOpts should be of type "Object"');if(!(0,v.isFunction)(o))throw new y.InvalidArgumentError('callback should be of type "function"');p.isEmpty(r)&&(r={defaultOpts:i});let n="legal-hold";r.versionId&&(n+=`&versionId=${r.versionId}`);let a={Status:r.status},s=new h.Builder({rootName:"LegalHold",renderOpts:{pretty:!1},headless:!0}),l=s.buildObject(a),u={};u["Content-MD5"]=(0,v.toMd5)(l),this.makeRequest({method:"PUT",bucketName:e,objectName:t,query:n,headers:u},l,[200],"",!1,o)}abortMultipartUpload(e,t,r,o){let i=`uploadId=${r}`;this.makeRequest({method:"DELETE",bucketName:e,objectName:t,query:i},"",[204],"",!1,o)}uploadPartCopy(e,t){let{bucketName:r,objectName:o,uploadID:n,partNumber:a,headers:s}=e,l=`uploadId=${n}&partNumber=${a}`;return this.makeRequest({method:"PUT",bucketName:r,objectName:o,query:l,headers:s},"",[200],"",!0,(e,r)=>{let n=i.from("");if(e)return t(e);(0,v.pipesetup)(r,B.uploadPartTransformer()).on("data",e=>{n=e}).on("error",t).on("end",()=>{t(null,{etag:(0,v.sanitizeETag)(n.ETag),key:o,part:a})})})}composeObject(e={},t=[],r){let o=this,i=t.length;if(!Array.isArray(t))throw new y.InvalidArgumentError("sourceConfig should an array of CopySourceOptions ");if(!(e instanceof g.CopyDestinationOptions))throw new y.InvalidArgumentError("destConfig should of type CopyDestinationOptions ");if(i<1||i>v.PART_CONSTRAINTS.MAX_PARTS_COUNT)throw new y.InvalidArgumentError(`"There must be as least one and up to ${v.PART_CONSTRAINTS.MAX_PARTS_COUNT} source objects.`);if(!(0,v.isFunction)(r))throw TypeError('callback should be of type "function"');for(let e=0;e<i;e++)if(!t[e].validate())return!1;if(!e.validate())return!1;let n=e=>{let t={};return p.isEmpty(e.VersionID)||(t={versionId:e.VersionID}),t},a=[],s=0,l=0,c=t.map(e=>o.statObject(e.Bucket,e.Object,n(e)));return Promise.all(c).then(n=>{let c=n.map((e,r)=>{let o=t[r],n=e.size;if(o.MatchRange){let e=o.Start,t=o.End;if(t>=n||e<0)throw new y.InvalidArgumentError(`CopySrcOptions ${r} has invalid segment-to-copy [${e}, ${t}] (size is ${n})`);n=t-e+1}if(n<v.PART_CONSTRAINTS.ABS_MIN_PART_SIZE&&r<i-1)throw new y.InvalidArgumentError(`CopySrcOptions ${r} is too small (${n}) and it is not the last part.`);if((s+=n)>v.PART_CONSTRAINTS.MAX_MULTIPART_PUT_OBJECT_SIZE)throw new y.InvalidArgumentError(`Cannot compose an object of size ${s} (> 5TiB)`);if(a[r]=n,(l+=(0,v.partsRequired)(n))>v.PART_CONSTRAINTS.MAX_PARTS_COUNT)throw new y.InvalidArgumentError(`Your proposed compose object requires more than ${v.PART_CONSTRAINTS.MAX_PARTS_COUNT} parts`);return e});if(1===l&&s<=v.PART_CONSTRAINTS.MAX_PART_SIZE||0===s)return this.copyObject(t[0],e,r);for(let e=0;e<i;e++)t[e].MatchETag=c[e].etag;let p=c.map((e,r)=>{let o=(0,v.calculateEvenSplits)(a[r],t[r]);return o}),d=i=>{let n=function(r){let o=[];return p.forEach((i,n)=>{let{startIndex:a,endIndex:s,objInfo:l}=i,u=n+1,c=Array.from(a),p=t[n].getHeaders();c.forEach((t,i)=>{let n=s[i],a=`${l.Bucket}/${l.Object}`;p["x-amz-copy-source"]=`${a}`,p["x-amz-copy-source-range"]=`bytes=${t}-${n}`;let c={bucketName:e.Bucket,objectName:e.Object,uploadID:r,partNumber:u,headers:p,sourceObj:a};o.push(c)})}),o}(i);u.map(n,o.uploadPartCopy.bind(o),(t,n)=>{if(t)return this.abortMultipartUpload(e.Bucket,e.Object,i,r);let a=n.map(e=>({etag:e.etag,part:e.part}));return o.completeMultipartUpload(e.Bucket,e.Object,i,a,r)})},f=e.getHeaders();o.initiateNewMultipartUpload(e.Bucket,e.Object,f,(e,t)=>{if(e)return r(e,null);d(t)})}).catch(e=>{r(e,null)})}selectObjectContent(e,t,r={},o){if(!(0,v.isValidBucketName)(e))throw new y.InvalidBucketNameError(`Invalid bucket name: ${e}`);if(!(0,v.isValidObjectName)(t))throw new y.InvalidObjectNameError(`Invalid object name: ${t}`);if(p.isEmpty(r))throw TypeError("valid select configuration is required");if(!(0,v.isString)(r.expression))throw TypeError('sqlExpression should be of type "string"');if(p.isEmpty(r.inputSerialization))throw TypeError("inputSerialization is required");if(!(0,v.isObject)(r.inputSerialization))throw TypeError('inputSerialization should be of type "object"');if(p.isEmpty(r.outputSerialization))throw TypeError("outputSerialization is required");if(!(0,v.isObject)(r.outputSerialization))throw TypeError('outputSerialization should be of type "object"');if(!(0,v.isFunction)(o))throw TypeError('callback should be of type "function"');let i="select";i+="&select-type=2";let n=[{Expression:r.expression},{ExpressionType:r.expressionType||"SQL"},{InputSerialization:[r.inputSerialization]},{OutputSerialization:[r.outputSerialization]}];r.requestProgress&&n.push({RequestProgress:r.requestProgress}),r.scanRange&&n.push({ScanRange:r.scanRange});let a=new h.Builder({rootName:"SelectObjectContentRequest",renderOpts:{pretty:!1},headless:!0}),s=a.buildObject(n);this.makeRequest({method:"POST",bucketName:e,objectName:t,query:i},s,[200],"",!0,(e,t)=>{let r;if(e)return o(e);(0,v.pipesetup)(t,B.selectObjectContentTransformer()).on("data",e=>{r=(0,S.parseSelectObjectContentResponse)(e)}).on("error",o).on("end",()=>{o(null,r)})})}get extensions(){return this.clientExtensions||(this.clientExtensions=new b.extensions(this)),this.clientExtensions}}t.Client=V,V.prototype.makeBucket=(0,j.promisify)(V.prototype.makeBucket),V.prototype.listBuckets=(0,j.promisify)(V.prototype.listBuckets),V.prototype.bucketExists=(0,j.promisify)(V.prototype.bucketExists),V.prototype.removeBucket=(0,j.promisify)(V.prototype.removeBucket),V.prototype.getObject=(0,j.promisify)(V.prototype.getObject),V.prototype.getPartialObject=(0,j.promisify)(V.prototype.getPartialObject),V.prototype.fGetObject=(0,j.promisify)(V.prototype.fGetObject),V.prototype.putObject=(0,j.promisify)(V.prototype.putObject),V.prototype.fPutObject=(0,j.promisify)(V.prototype.fPutObject),V.prototype.copyObject=(0,j.promisify)(V.prototype.copyObject),V.prototype.statObject=(0,j.promisify)(V.prototype.statObject),V.prototype.removeObject=(0,j.promisify)(V.prototype.removeObject),V.prototype.removeObjects=(0,j.promisify)(V.prototype.removeObjects),V.prototype.presignedUrl=(0,j.promisify)(V.prototype.presignedUrl),V.prototype.presignedGetObject=(0,j.promisify)(V.prototype.presignedGetObject),V.prototype.presignedPutObject=(0,j.promisify)(V.prototype.presignedPutObject),V.prototype.presignedPostPolicy=(0,j.promisify)(V.prototype.presignedPostPolicy),V.prototype.getBucketNotification=(0,j.promisify)(V.prototype.getBucketNotification),V.prototype.setBucketNotification=(0,j.promisify)(V.prototype.setBucketNotification),V.prototype.removeAllBucketNotification=(0,j.promisify)(V.prototype.removeAllBucketNotification),V.prototype.getBucketPolicy=(0,j.promisify)(V.prototype.getBucketPolicy),V.prototype.setBucketPolicy=(0,j.promisify)(V.prototype.setBucketPolicy),V.prototype.removeIncompleteUpload=(0,j.promisify)(V.prototype.removeIncompleteUpload),V.prototype.getBucketVersioning=(0,j.promisify)(V.prototype.getBucketVersioning),V.prototype.setBucketVersioning=(0,j.promisify)(V.prototype.setBucketVersioning),V.prototype.setBucketTagging=(0,j.promisify)(V.prototype.setBucketTagging),V.prototype.removeBucketTagging=(0,j.promisify)(V.prototype.removeBucketTagging),V.prototype.getBucketTagging=(0,j.promisify)(V.prototype.getBucketTagging),V.prototype.setObjectTagging=(0,j.promisify)(V.prototype.setObjectTagging),V.prototype.removeObjectTagging=(0,j.promisify)(V.prototype.removeObjectTagging),V.prototype.getObjectTagging=(0,j.promisify)(V.prototype.getObjectTagging),V.prototype.setBucketLifecycle=(0,j.promisify)(V.prototype.setBucketLifecycle),V.prototype.getBucketLifecycle=(0,j.promisify)(V.prototype.getBucketLifecycle),V.prototype.removeBucketLifecycle=(0,j.promisify)(V.prototype.removeBucketLifecycle),V.prototype.setObjectLockConfig=(0,j.promisify)(V.prototype.setObjectLockConfig),V.prototype.getObjectLockConfig=(0,j.promisify)(V.prototype.getObjectLockConfig),V.prototype.putObjectRetention=(0,j.promisify)(V.prototype.putObjectRetention),V.prototype.getObjectRetention=(0,j.promisify)(V.prototype.getObjectRetention),V.prototype.setBucketEncryption=(0,j.promisify)(V.prototype.setBucketEncryption),V.prototype.getBucketEncryption=(0,j.promisify)(V.prototype.getBucketEncryption),V.prototype.removeBucketEncryption=(0,j.promisify)(V.prototype.removeBucketEncryption),V.prototype.setBucketReplication=(0,j.promisify)(V.prototype.setBucketReplication),V.prototype.getBucketReplication=(0,j.promisify)(V.prototype.getBucketReplication),V.prototype.removeBucketReplication=(0,j.promisify)(V.prototype.removeBucketReplication),V.prototype.setObjectLegalHold=(0,j.promisify)(V.prototype.setObjectLegalHold),V.prototype.getObjectLegalHold=(0,j.promisify)(V.prototype.getObjectLegalHold),V.prototype.composeObject=(0,j.promisify)(V.prototype.composeObject),V.prototype.selectObjectContent=(0,j.promisify)(V.prototype.selectObjectContent)}}]);